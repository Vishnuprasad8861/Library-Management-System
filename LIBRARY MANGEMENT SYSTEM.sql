-- MODULE_END_PROJECT -------

-------------------------------------------------------------
-- LIBRARY MANAGEMENT SYSTEM -------------
-------------------------------------------------------------

-- CREATING A DATABASE NAMED LIBRARY-----

CREATE DATABASE LIBRARY;

------------------------------------------------------
-- CREATE TABLES FOR LIBRARY
------------------------------------------------
-------------------------------
-- 1. TABLES FOR BRANCH
--------------------------------

CREATE TABLE BRANCH (
BRANCH_NO INT PRIMARY KEY,
MANAGER_ID VARCHAR(30),
BRANCH_ADRESS VARCHAR(200),
CONTACT_NO  VARCHAR(20)
);

-----------------------------------------------
-- INSERTING VALUES INTO TABLE BRANCH
----------------------------------------------

INSERT INTO BRANCH (BRANCH_NO,MANAGER_ID,BRANCH_ADRESS,CONTACT_NO) VALUES
(249,'TS4321','ROSEWOODSTREET','0219374901'),
(239,'YS0971','7TH AVENUE','9128537802'),
(123,'ZQ2389','REGO PARK','0435619031'),
(789,'KW9812','BROOKYLN','8213765400'),
(901,'DQ1292','ELMONT','1239093728'),
(821,'PW4321','ADRIAN EVE','6723190021'),
(021,'RE9021','BAXTER ST','231782981'),
(912,'EW7718','CARDER RD','728391023'),
(334,'FS1223','ASTOR PI','2345190673'),
(563,'TU3456','DOVER ST','6645328133'),
(443,'AS0013','FRANKLIN ST','9923457788'),
(345,'OP1290','GRAND ST','8086361891'),
(299,'LB9340','MORRIS LANE','7328901877');


SELECT * FROM BRANCH;

------------------------------
-- 2.TABLES FOR EMPLOYEE
------------------------------

CREATE TABLE EMPLOYEE (
    EMP_ID VARCHAR(30) PRIMARY KEY,
    EMP_NAME VARCHAR(40),
    POSITION VARCHAR(30),
    SALARY VARCHAR(10),
    BRANCH_NO INT,
    FOREIGN KEY (BRANCH_NO)
        REFERENCES BRANCH (BRANCH_NO)
);

-----------------------------------------------
-- INSERTING VALUES INTO TABLE EMPLOYEE
----------------------------------------------

INSERT INTO EMPLOYEE VALUES 

('PDG892', 'DAVID LEE', 'LIBRARY TECHNICIAN', '45,000', 901),
('JAG617', 'SOPHIA PAUL', 'LIBRARIAN', '76,000', 299),
('FAU919', 'JENNY JOHN', 'ASSISTANT LIBRARIAN', '45,000', 821),
('DAW881', 'MICHAEL BAY', 'IT SUPPORT', '39,000', 334),
('ERY919', 'RYAN PAUL', 'INFORMATION SPECIALIST', '45,000', 563),
('WKP322', 'DANIEL CRAG', 'HUMAN RESOURCE', '87,000', 912),
('UKF998', 'TIM JAME', 'LIBRARIAN', '56,000', 443),
('PKT189', 'MARY MARIA', 'LIBRARIAN TRAINEE', '35,000', 299),
('TYU656', 'MATHEW WADE', 'HUMAN RESOURCE', '42,000', 821),
('KIY887', 'OLIVER JADE', 'INFORMATION SPECIALIST', '38,000', 123),
('PGF456', 'AIDEN AGIN', 'IT SUPPORT', '23,000', 789),
('RTY434', 'ALDRIN JOY', 'LIBRARIAN', '45,000', 239),
('STR309', 'JESSE RYDER', 'LIBRARIAN', '42,000', 821),
('ASD732', 'SHAUN TAIT', 'HUMAN RESOURCE', '33,500', 443),
('ASV328', 'MITCH MARSH', 'LIBRARY ASSISTANT', '58,000', 123);

INSERT INTO EMPLOYEE  VALUES 
('ZFT190', 'JOHN PETER', 'LIBRARY ASSISTANT', '55,000', 249);


SELECT * FROM EMPLOYEE;
------------------------------
-- 3.TABLES FOR BOOKS
------------------------------

 CREATE TABLE BOOKS (
 ISBN VARCHAR(100) PRIMARY KEY,
 BOOK_TITLE VARCHAR(200),
 CATEGORY VARCHAR(100),
 RENTAL_PRICE VARCHAR (50),
 STATUS ENUM ('YES BOOK AVAIL','NO BOOK AVAIL'),
 AUTHOR VARCHAR (100),
 PUBLISHER VARCHAR(100)
 );
 
-----------------------------------------------
-- INSERTING VALUES INTO TABLE BOOKS
----------------------------------------------
INSERT INTO BOOKS (ISBN,BOOK_TITLE,CATEGORY,RENTAL_PRICE,STATUS,AUTHOR,PUBLISHER) VALUES
('978-1-60309-502-0','THE HUNGER GAME','FICTION','20/W','YES BOOK AVAIL','SUZANNE COLLINS','SCHOLIATIC PRESS'),
('109-7-81408-855-6','HARRY POTTER AND THE ORDER OF THE PHOENIX','FANTASY','25/W','YES BOOK AVAIL','JK ROWLING','BLOOMSBURY(UK)'),
('978-1-50329-056-3','PRIDE AND PREJUDICE','CLASSIC','20/W','YES BOOK AVAIL','JANE AUSTEN','T EGERTON'),
('978-8-12913-742-5','MAKING INDIA AWESOME','NOVEL','23/W','YES BOOK AVAIL','CHETAN BHAGAT','RUPA PUBLICATIONS'),
('978-8-12914-214-6','ONE INDIAN GIRL','NOVEL','23/W','YES BOOK AVAIL','CHETAN BHAGAT','RUPA PUBLICATIONS'),
('076-4-10690-989-5','THE NAKED TRIANGLE','AUTOBIOGRAPHY','30/W','YES BOOK AVAIL','BALWANT GARGI','VIKAS PUBLISHING HOUSE'),
('978-0-33037-617-4','FLUKE','HORROR','15/W','NO BOOK AVAIL','JAMES HERBERT','PAN BOOKS'),
('05-5329-340-0','ASIMOV','SCIENCE FICTION','20/W','YES BOOK AVAIL','ISSAC ASIMOV','BANTAM BOOKS'),
('97-8185-326-726-0','LADY AUDLEYS SECRET','LITERATURE','25/W','YES BOOK AVAIL','MARY ELIZABETH BRADEN','WORDS WORTH CLASSIC'),
('19-0528-729-1','JOHNNY DEPP','FILM','20/W','NO BOOK AVAIL','DENIS MEIKLE','REYNOLDS AND HERN'),
('02-4051-034-8','NIKON FE FM EM','PHOTOGRAPHY','20/W','YES BOOK AVAIL','CLYDE REYNOLDS','FOCAL PRESS LIMITED'),
('07-1344-774-5','INDIAN INDEPENDENCE','HISTORY','20/W','YES BOOK AVAIL','STEPHEN ASHTON','BASTFORD ACADEMIC AND EDUCATIONAL'),
('978-03-4547-609-8','THE GUNS OF AUGUST','HISTORY','25/W','YES BOOK AVAIL','BARBARA W TUCHMAN','MACMILLAN'),
('978-00-6231-609-7','SAPIENS','NON-FICTION','30/W','YES BOOK AVAIL','YUVAL NOAH HARARI','RANDOM HOUSE'),
('978-01-9503-863-7','BATTLE CRY FOR FREEDOM','HISTORY','25/W','NO BOOK AVAIL','JAMES M MCPHERSON','OXFORD UNIVERSITY PRESS'),
('14-5162-665-0','CATCH-22','POLITICAL','25/W','YES BOOK AVAIL','JOSEPH HELLER','SIMON AND SCHUSTER'),
('17-8396-602-5','THE POWER OF GEOGRAPHY','GEOPOLITICS','20/W','YES BOOK AVAIL','TIM MARSHALL','ELLIOT AND THOMSON'),
('81-3160-716-8','EVOLUTION OF GEOGRAPHICAL THOUGHT','GEOPOLITCS','25/W','NO BOOK AVAIL','MAJID HUSSAIN','RAWAT PUBLISH');


SELECT * FROM BOOKS;

------------------------------
-- 4.TABLES FOR CUSTOMER_LIBRARY
------------------------------

CREATE TABLE CUSTOMER_LIBRARY (
CUSTOMER_ID VARCHAR(50) PRIMARY KEY,
CUSTOMER_NAME VARCHAR(100),
CUSTOMER_ADDRESS VARCHAR(200),
REG_DATE DATE
);

DESC CUSTOMER_LIBRARY;

-----------------------------------------------------
-- INSERTING VALUES INTO TABLE CUSTOMER_LIBRARY
-----------------------------------------------------
INSERT INTO CUSTOMER_LIBRARY (CUSTOMER_ID,CUSTOMER_NAME,CUSTOMER_ADDRESS,REG_DATE) VALUES
('D5091','JOHN PERERA','ROSE VILLA 5TH STREET NEWYORK CITY','1992-01-21'),
('K9086','KENNEDY BAY','NO;21 WEST AVENUE CALIFORNIA','1997-02-12'),
('T1271','MICHALE JHONY','FLAT NO;28 SECOND AVENUE TEXAS','1988-03-11'),
('Y8907','JACK DANIEL','MICHALE STREET NO;12 ,BOSTON','1996-04-02'),
('R8765','TIM MARSH','HOUSE NO;123 NORTH AVENUE LOSANGELS','1999-01-21'),
('Q3456','MARIA TOM','BARD HNO;787 WEST STREET NEWYORK CITY','2001-10-31'),
('E5678','TONY FRANCIS','FLAT NO ;321 VICTORIA STREET AUSTON','2002-11-23'),
('R2342','ANGELO MATHEWS','SWEET HOME NORTH END KENTUKY','1996-03-22'),
('Y9232','FERNANDO GOMEZ','MAXON 3RD STREET TOKYO','1987-11-11'),
('U2319','ANGELINE BEN','ALIA WESTCOAST JUNCTION TOKIO','1993-12-30'),
('K6633','ANNA BEN','BEN HOME DOOR NO;27 CHICAGO','1996-09-22');

INSERT INTO CUSTOMER_LIBRARY VALUES
('P3456','BRET JOHN','HEAVEAN Y STREET CALIFORNIA','2024-10-12'),
('T1289','MATHEW PHILIP','GREEN HOUSE PHILADELPHIA','2023-09-17');

SELECT * FROM CUSTOMER_LIBRARY;



------------------------------
-- 5.TABLES FOR ISSUE STATUS
------------------------------

CREATE TABLE ISSUESTATUS (
ISSUE_ID VARCHAR(50) PRIMARY KEY,
ISSUED_CUST VARCHAR (50) ,
FOREIGN KEY (ISSUED_CUST) REFERENCES CUSTOMER_LIBRARY(CUSTOMER_ID),
ISSUED_BOOK_NAME VARCHAR(100),
ISSUE_DATE DATE,
ISBN_BOOK VARCHAR(50),
FOREIGN KEY (ISBN_BOOK) REFERENCES BOOKS(ISBN)
);

-----------------------------------------------------
-- INSERTING VALUES INTO TABLE ISSUESTATUS
-----------------------------------------------------
INSERT INTO ISSUESTATUS  VALUES
('ISD2234','D5091','THE HUNGER GAME','1993-08-11','978-1-60309-502-0'),
('ISD1321','K9086','PRIDE AND PREJUDICE','1997-02-15','978-1-50329-056-3'),
('ISD2323','T1271','THE NAKED TRIANGLE','1988-05-10','076-4-10690-989-5'),
('ISD1290','R8765','THE GUNS OF AUGUST','1999-01-21','978-03-4547-609-8'),
('ISD9031','K6633','CATCH-22','1998-10-12','14-5162-665-0'),
('ISD2874','T1271','SAPIENS','1988-03-11','978-00-6231-609-7'),
('ISD3678','R8765','INDIAN INDEPENDENCE','1999-01-21','07-1344-774-5'),
('ISD6547','U2319','EVOLUTION OF GEOGRAPHICAL THOUGHT','1993-12-30','81-3160-716-8'),
('ISD8291','D5091','BATTLE CRY FOR FREEDOM','1993-01-21','978-01-9503-863-7'),
('ISD1002','Y9232','NIKON FE FM EM','1989-11-12','02-4051-034-8'),
('ISD1235','Q3456','THE GUNS OF AUGUST','2001-12-31','978-03-4547-609-8'),
('ISD7658','Y9232','THE POWER OF GEOGRAPHY','1990-10-22','17-8396-602-5'),
('ISD2221','D5091','ONE INDIAN GIRL','2020-09-20','978-8-12914-214-6'),
('ISD3200','Y8907','BATTLE CRY FOR FREEDOM','1999-06-23','978-01-9503-863-7'),
('ISD2991','U2319','THE GUNS OF AUGUST','1998-02-10','978-03-4547-609-8'),
('ISD4278','E5678','HARRY POTTER AND THE ORDER OF THE PHOENIX','2023-06-12','109-7-81408-855-6'),
('ISD7821','K9086','FLUKE','2021-10-23','978-0-33037-617-4'),
('ISD9123','Y9232','MAKING INDIA AWESOME','2020-07-20','978-8-12913-742-5'),
('ISD1890','R2342','SAPIENS','2023-06-21','978-00-6231-609-7'),
('ISD6543','Q3456','PRIDE AND PREJUDICE','2021-08-11','978-1-50329-056-3'),
('ISD2112','T1271','LADY AUDLEYS SECRET','1996-09-12','97-8185-326-726-0'),
('ISD3423','Y9232','MAKING INDIA AWESOME','1992-03-12','978-8-12913-742-5');



SELECT * FROM ISSUESTATUS;


------------------------------
-- 6.RETURN STATUS
------------------------------

CREATE TABLE RETURN_STATUS(
RETURN_ID VARCHAR(50) PRIMARY KEY,
RETURN_CUST VARCHAR(200),
RETURN_BOOK_NAME VARCHAR(200),
RETURN_DATE DATE,
ISBN_BOOK2 VARCHAR(50),
FOREIGN KEY (ISBN_BOOK2) REFERENCES BOOKS(ISBN)
);

-----------------------------------------------------
-- INSERTING VALUES INTO TABLE RETURN_STATUS
-----------------------------------------------------

INSERT INTO RETURN_STATUS VALUES 
('RTB2345','JOHN PERERA','THE HUNGER GAME','1993-09-11','978-1-60309-502-0'),
('RTE2921','KENNEDY BAY','PRIDE AND PREJUDICE','1997-03-15','978-1-50329-056-3'),
('RTA0345','MICHALE JHONY','THE NAKED TRIANGLE','1988-06-11','076-4-10690-989-5'),
('RTE2890','TIM MARSH','THE GUNS OF AUGUST','1999-02-10','978-03-4547-609-8'),
('RTW3802','TONY FRANCIS','HARRY POTTER AND THE ORDER OF THE PHOENIX','2023-08-12','109-7-81408-855-6'),
('RTB3378','ANGELO MATHEWS','SAPIENS','1996-06-22','978-00-6231-609-7'),
('RTV7219','ANNA BEN','CATCH-22','1998-11-12','14-5162-665-0'),
('RTG8904','MARIA TOM','PRIDE AND PREJUDICE','2021-08-19','978-1-50329-056-3'),
('RTH3901','ANGELINE BEN','CATCH-22','1998-10-12','14-5162-665-0');

SELECT * FROM RETURN_STATUS;

-----------------------------------------
-- QUERIES OF FOLLOWING 
-----------------------------------------

-- 1.Retrieve the book title, category, and rental price of all available books.

SELECT  BOOK_TITLE,CATEGORY, RENTAL_PRICE FROM BOOKS WHERE STATUS = 'YES BOOK AVAIL';

-- 2. List the employee names and their respective salaries in descending order of salary.

SELECT EMP_NAME,SALARY FROM EMPLOYEE ORDER BY SALARY DESC;

-- 3. Retrieve the book titles and the corresponding customers who have issued those books.

SELECT CUSTOMER_ID,ISSUED_BOOK_NAME AS BOOK_TITLES
 FROM ISSUESTATUS
 JOIN CUSTOMER_LIBRARY 
 ON ISSUESTATUS.ISSUED_CUST=CUSTOMER_LIBRARY.CUSTOMER_ID;
 
 -- 4.Display the total count of books in each category.
 
 SELECT CATEGORY ,COUNT(*) AS TOTAL_BOOK_COUNT FROM BOOKS GROUP BY CATEGORY;
 
 -- 5. Retrieve the employee names and their positions for the employees whose salaries are above Rs.50,000.
 
 SELECT EMP_NAME,POSITION FROM EMPLOYEE WHERE SALARY>'50000';
 
 -- 6. List the customer names who registered before 2022-01-01 and have not issued any books yet.
 
 SELECT CUSTOMER_NAME
FROM CUSTOMER_LIBRARY
WHERE REG_DATE < '2022-01-01'
AND CUSTOMER_ID NOT IN (
    SELECT DISTINCT ISSUED_CUST
    FROM ISSUESTATUS
);

 -- 7. Display the branch numbers and the total count of employees in each branch.
 
 SELECT BRANCH_NO ,COUNT(*) AS TOTAL_NO_EMPLOYEES FROM EMPLOYEE GROUP BY  BRANCH_NO;


-- 8. Display the names of customers who have issued books in the month of June 2023.

SELECT CUSTOMER_LIBRARY.CUSTOMER_NAME FROM CUSTOMER_LIBRARY
JOIN ISSUESTATUS ON CUSTOMER_LIBRARY. CUSTOMER_ID=ISSUESTATUS.ISSUED_CUST
WHERE MONTH(ISSUESTATUS.ISSUE_DATE)=6 AND YEAR( ISSUESTATUS.ISSUE_DATE)=2023;
 
 
-- 9. Retrieve the book_title from the book table containing history.

SELECT BOOK_TITLE,CATEGORY FROM BOOKS WHERE CATEGORY ='HISTORY';


-- 10.Retrieve the branch numbers along with the count of employees for branches having more than 5 employees

SELECT BRANCH_NO, COUNT(*) AS EMPLOYEE_COUNT
FROM EMPLOYEE
GROUP BY BRANCH_NO
HAVING COUNT(*) > 5;
